\chapter{raw-\/body}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e}{}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e}\index{raw-\/body@{raw-\/body}}
\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1784}%
\Hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1784}%


\href{https://npmjs.org/package/raw-body}{\texttt{ }} \href{https://npmjs.org/package/raw-body}{\texttt{ }} \href{https://nodejs.org/en/download/}{\texttt{ }} \href{https://github.com/jshttp/stream-utils/raw-body?query=workflow\%3Aci}{\texttt{ }} \href{https://coveralls.io/r/stream-utils/raw-body?branch=master}{\texttt{ }}

Gets the entire buffer of a stream either as a {\ttfamily Buffer} or a string. Validates the stream\textquotesingle{}s length against an expected length and maximum limit. Ideal for parsing request bodies.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1785}{}\doxysection{\texorpdfstring{Install}{Install}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1785}
This is a \href{https://nodejs.org/en/}{\texttt{ Node.\+js}} module available through the \href{https://www.npmjs.com/}{\texttt{ npm registry}}. Installation is done using the \href{https://docs.npmjs.com/getting-started/installing-npm-packages-locally}{\texttt{ {\ttfamily npm install} command}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ raw-\/body}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1786}{}\doxysubsection{\texorpdfstring{Type\+Script}{Type\+Script}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1786}
This module includes a \href{https://www.typescriptlang.org/}{\texttt{ Type\+Script}} declaration file to enable auto complete in compatible editors and type information for Type\+Script projects. This module depends on the Node.\+js types, so install {\ttfamily @types/node}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ @types/node}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1787}{}\doxysection{\texorpdfstring{API}{API}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1787}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ getRawBody\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}(\textcolor{stringliteral}{'raw-\/body'})}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1788}{}\doxysubsection{\texorpdfstring{get\+Raw\+Body(stream, \mbox{[}options\mbox{]}, \mbox{[}callback\mbox{]})}{get\+Raw\+Body(stream, \mbox{[}options\mbox{]}, \mbox{[}callback\mbox{]})}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1788}
{\bfseries{Returns a promise if no callback specified and global {\ttfamily Promise} exists.}}

Options\+:


\begin{DoxyItemize}
\item {\ttfamily length} -\/ The length of the stream. If the contents of the stream do not add up to this length, an {\ttfamily 400} error code is returned.
\item {\ttfamily limit} -\/ The byte limit of the body. This is the number of bytes or any string format supported by \href{https://www.npmjs.com/package/bytes}{\texttt{ bytes}}, for example {\ttfamily 1000}, `\textquotesingle{}500kb'{\ttfamily or}\textquotesingle{}3mb\textquotesingle{}{\ttfamily . If the body ends up being larger than this limit, a}413{\ttfamily error code is returned. -\/}encoding{\ttfamily -\/ The encoding to use to decode the body into a string. By default, a}Buffer{\ttfamily instance will be returned when no encoding is specified. Most likely, you want}utf-\/8{\ttfamily , so setting}encoding{\ttfamily to}true{\ttfamily will decode as}utf-\/8\`{}. You can use any type of encoding supported by \href{https://www.npmjs.org/package/iconv-lite\#readme}{\texttt{ iconv-\/lite}}.
\end{DoxyItemize}

You can also pass a string in place of options to just specify the encoding.

If an error occurs, the stream will be paused, everything unpiped, and you are responsible for correctly disposing the stream. For HTTP requests, you may need to finish consuming the stream if you want to keep the socket open for future requests. For streams that use file descriptors, you should {\ttfamily stream.\+destroy()} or {\ttfamily stream.\+close()} to prevent leaks.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1789}{}\doxysection{\texorpdfstring{Errors}{Errors}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1789}
This module creates errors depending on the error condition during reading. The error may be an error from the underlying Node.\+js implementation, but is otherwise an error created by this module, which has the following attributes\+:


\begin{DoxyItemize}
\item {\ttfamily limit} -\/ the limit in bytes
\item {\ttfamily length} and {\ttfamily expected} -\/ the expected length of the stream
\item {\ttfamily received} -\/ the received bytes
\item {\ttfamily encoding} -\/ the invalid encoding
\item {\ttfamily status} and {\ttfamily status\+Code} -\/ the corresponding status code for the error
\item {\ttfamily type} -\/ the error type
\end{DoxyItemize}\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1790}{}\doxysubsection{\texorpdfstring{Types}{Types}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1790}
The errors from this module have a {\ttfamily type} property which allows for the programmatic determination of the type of error returned.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1791}{}\doxysubsubsection{\texorpdfstring{encoding.\+unsupported}{encoding.\+unsupported}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1791}
This error will occur when the {\ttfamily encoding} option is specified, but the value does not map to an encoding supported by the \href{https://www.npmjs.org/package/iconv-lite\#readme}{\texttt{ iconv-\/lite}} module.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1792}{}\doxysubsubsection{\texorpdfstring{entity.\+too.\+large}{entity.\+too.\+large}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1792}
This error will occur when the {\ttfamily limit} option is specified, but the stream has an entity that is larger.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1793}{}\doxysubsubsection{\texorpdfstring{request.\+aborted}{request.\+aborted}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1793}
This error will occur when the request stream is aborted by the client before reading the body has finished.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1794}{}\doxysubsubsection{\texorpdfstring{request.\+size.\+invalid}{request.\+size.\+invalid}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1794}
This error will occur when the {\ttfamily length} option is specified, but the stream has emitted more bytes.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1795}{}\doxysubsubsection{\texorpdfstring{stream.\+encoding.\+set}{stream.\+encoding.\+set}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1795}
This error will occur when the given stream has an encoding set on it, making it a decoded stream. The stream should not have an encoding set and is expected to emit {\ttfamily Buffer} objects.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1796}{}\doxysubsubsection{\texorpdfstring{stream.\+not.\+readable}{stream.\+not.\+readable}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1796}
This error will occur when the given stream is not readable.\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1797}{}\doxysection{\texorpdfstring{Examples}{Examples}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1797}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1798}{}\doxysubsection{\texorpdfstring{Simple Express example}{Simple Express example}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1798}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ \mbox{\hyperlink{response_8js_aaa70baea2218f3239c21c4a23f9569e3}{contentType}}\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}(\textcolor{stringliteral}{'content-\/type'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{server_8js_a81e570c198204c57e1ebcace4f4e6dad}{express}}\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}('\mbox{\hyperlink{server_8js_a81e570c198204c57e1ebcace4f4e6dad}{express}}')}
\DoxyCodeLine{var\ getRawBody\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}('\mbox{\hyperlink{express_8js_a6fddf0a674d03300188e5ba3195c9a00}{raw}}-\/body')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ \mbox{\hyperlink{application_8js_a7b225fcb720e4d5ed2bbf60e28a25e6d}{app}}\ =\ \mbox{\hyperlink{server_8js_a81e570c198204c57e1ebcace4f4e6dad}{express}}()}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{application_8js_a7b225fcb720e4d5ed2bbf60e28a25e6d}{app}}.\mbox{\hyperlink{application_8js_a8192500ed5d08ae60d3778b54729bd51}{use}}(\mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}},\ next)\ \{}
\DoxyCodeLine{\ \ getRawBody(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \{}
\DoxyCodeLine{\ \ \ \ length:\ \mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}}.headers[\textcolor{stringliteral}{'content-\/length'}],}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{qs_2lib_2utils_8js_abcb5d8b4a4a1f3baf285ff81dae46fdf}{limit}}:\ \textcolor{stringliteral}{'1mb'},}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{negotiator_2index_8js_a9ad8213a7626ee07aef47950752cac18}{encoding}}:\ \mbox{\hyperlink{response_8js_aaa70baea2218f3239c21c4a23f9569e3}{contentType}}.parse(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}}).parameters.charset}
\DoxyCodeLine{\ \ \},\ \mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (err,\ \textcolor{keywordtype}{string})\ \{}
\DoxyCodeLine{\ \ \ \ \textcolor{keywordflow}{if}\ (err)\ \textcolor{keywordflow}{return}\ next(err)}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}}.text\ =\ \textcolor{keywordtype}{string}}
\DoxyCodeLine{\ \ \ \ next()}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ now\ access\ req.text}}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1799}{}\doxysubsection{\texorpdfstring{Simple Koa example}{Simple Koa example}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1799}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ \mbox{\hyperlink{response_8js_aaa70baea2218f3239c21c4a23f9569e3}{contentType}}\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}(\textcolor{stringliteral}{'content-\/type'})}
\DoxyCodeLine{var\ getRawBody\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}('\mbox{\hyperlink{express_8js_a6fddf0a674d03300188e5ba3195c9a00}{raw}}-\/body')}
\DoxyCodeLine{var\ koa\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}('koa')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ \mbox{\hyperlink{application_8js_a7b225fcb720e4d5ed2bbf60e28a25e6d}{app}}\ =\ koa()}
\DoxyCodeLine{}
\DoxyCodeLine{\mbox{\hyperlink{application_8js_a7b225fcb720e4d5ed2bbf60e28a25e6d}{app}}.\mbox{\hyperlink{application_8js_a8192500ed5d08ae60d3778b54729bd51}{use}}(\mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ *\ (next)\ \{}
\DoxyCodeLine{\ \ this.text\ =\ yield\ getRawBody(this.req,\ \{}
\DoxyCodeLine{\ \ \ \ length:\ this.req.headers[\textcolor{stringliteral}{'content-\/length'}],}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{qs_2lib_2utils_8js_abcb5d8b4a4a1f3baf285ff81dae46fdf}{limit}}:\ \textcolor{stringliteral}{'1mb'},}
\DoxyCodeLine{\ \ \ \ \mbox{\hyperlink{negotiator_2index_8js_a9ad8213a7626ee07aef47950752cac18}{encoding}}:\ \mbox{\hyperlink{response_8js_aaa70baea2218f3239c21c4a23f9569e3}{contentType}}.parse(this.req).parameters.charset}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ yield\ next}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{//\ now\ access\ this.text}}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1800}{}\doxysubsection{\texorpdfstring{Using as a promise}{Using as a promise}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1800}
To use this library as a promise, simply omit the {\ttfamily callback} and a promise is returned, provided that a global {\ttfamily Promise} is defined.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ getRawBody\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}(\textcolor{stringliteral}{'raw-\/body'})}
\DoxyCodeLine{var\ \mbox{\hyperlink{application_8js_a55f22d498ca401fddca364855629d1d3}{http}}\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}('\mbox{\hyperlink{application_8js_a55f22d498ca401fddca364855629d1d3}{http}}')}
\DoxyCodeLine{}
\DoxyCodeLine{var\ server\ =\ \mbox{\hyperlink{application_8js_a55f22d498ca401fddca364855629d1d3}{http}}.createServer(\mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}})\ \{}
\DoxyCodeLine{\ \ getRawBody(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}})}
\DoxyCodeLine{\ \ \ \ .then(\mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (buf)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}.statusCode\ =\ 200}
\DoxyCodeLine{\ \ \ \ \ \ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}.end(buf.length\ +\ \textcolor{stringliteral}{'\ bytes\ submitted'})}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\ \ \ \ .\textcolor{keywordflow}{catch}(\mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (err)\ \{}
\DoxyCodeLine{\ \ \ \ \ \ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}.statusCode\ =\ 500}
\DoxyCodeLine{\ \ \ \ \ \ \mbox{\hyperlink{express_8js_abde3c35e3bb7e5225dd7f234c685329c}{res}}.end(err.message)}
\DoxyCodeLine{\ \ \ \ \})}
\DoxyCodeLine{\})}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000)}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1801}{}\doxysubsection{\texorpdfstring{Using with Type\+Script}{Using with Type\+Script}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1801}

\begin{DoxyCode}{0}
\DoxyCodeLine{import\ *\ as\ getRawBody\ from\ 'raw-\/body';}
\DoxyCodeLine{import\ *\ as\ http\ from\ 'http';}
\DoxyCodeLine{}
\DoxyCodeLine{const\ server\ =\ http.createServer((req,\ res)\ =>\ \{}
\DoxyCodeLine{\ \ getRawBody(req)}
\DoxyCodeLine{\ \ .then((buf)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ res.statusCode\ =\ 200;}
\DoxyCodeLine{\ \ \ \ res.end(buf.length\ +\ '\ bytes\ submitted');}
\DoxyCodeLine{\ \ \})}
\DoxyCodeLine{\ \ .catch((err)\ =>\ \{}
\DoxyCodeLine{\ \ \ \ res.statusCode\ =\ err.statusCode;}
\DoxyCodeLine{\ \ \ \ res.end(err.message);}
\DoxyCodeLine{\ \ \});}
\DoxyCodeLine{\});}
\DoxyCodeLine{}
\DoxyCodeLine{server.listen(3000);}

\end{DoxyCode}
\hypertarget{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1802}{}\doxysection{\texorpdfstring{License}{License}}\label{md_node__modules_2raw-body_2_r_e_a_d_m_e_autotoc_md1802}
\mbox{[}MIT\mbox{]}(LICENSE) 