\chapter{proxy-\/addr}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e}{}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e}\index{proxy-\/addr@{proxy-\/addr}}
\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1618}%
\Hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1618}%


\href{https://npmjs.org/package/proxy-addr}{\texttt{ }} \href{https://npmjs.org/package/proxy-addr}{\texttt{ }} \href{https://nodejs.org/en/download}{\texttt{ }} \href{https://github.com/jshttp/proxy-addr/actions?query=workflow\%3Aci}{\texttt{ }} \href{https://coveralls.io/r/jshttp/proxy-addr?branch=master}{\texttt{ }}

Determine address of proxied request\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1619}{}\doxysection{\texorpdfstring{Install}{Install}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1619}
This is a \href{https://nodejs.org/en/}{\texttt{ Node.\+js}} module available through the \href{https://www.npmjs.com/}{\texttt{ npm registry}}. Installation is done using the \href{https://docs.npmjs.com/getting-started/installing-npm-packages-locally}{\texttt{ {\ttfamily npm install} command}}\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ install\ proxy-\/addr}

\end{DoxyCode}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1620}{}\doxysection{\texorpdfstring{API}{API}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1620}

\begin{DoxyCode}{0}
\DoxyCodeLine{var\ \mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}\ =\ \mbox{\hyperlink{test-core-js_8js_a2fc998a372f1531668f7047d0878effe}{require}}(\textcolor{stringliteral}{'proxy-\/addr'})}

\end{DoxyCode}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1621}{}\doxysubsection{\texorpdfstring{proxyaddr(req, trust)}{proxyaddr(req, trust)}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1621}
Return the address of the request, using the given {\ttfamily trust} parameter.

The {\ttfamily trust} argument is a function that returns {\ttfamily true} if you trust the address, {\ttfamily false} if you don\textquotesingle{}t. The closest untrusted address is returned.


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (addr)\ \{\ \textcolor{keywordflow}{return}\ addr\ ===\ \textcolor{stringliteral}{'127.0.0.1'}\ \})}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \mbox{\hyperlink{cors_2lib_2index_8js_ac2ffb26d6f42d3bbcd7847b0873403f4}{function}}\ (addr,\ i)\ \{\ \textcolor{keywordflow}{return}\ i\ <\ 1\ \})}

\end{DoxyCode}


The {\ttfamily trust} arugment may also be a single IP address string or an array of trusted addresses, as plain IP addresses, CIDR-\/formatted strings, or IP/netmask strings.


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \textcolor{stringliteral}{'127.0.0.1'})}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ ['127.0.0.0/8',\ '10.0.0.0/8'])}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ ['127.0.0.0/255.0.0.0',\ '192.168.0.0/255.255.0.0'])}

\end{DoxyCode}


This module also supports IPv6. Your IPv6 addresses will be normalized automatically (i.\+e. {\ttfamily fe80\+:\+:00ed\+:1} equals {\ttfamily fe80\+:0\+:0\+:0\+:0\+:0\+:ed\+:1}).


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \textcolor{stringliteral}{'::1'})}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ ['::1/128',\ 'fe80::/10'])}

\end{DoxyCode}


This module will automatically work with IPv4-\/mapped IPv6 addresses as well to support node.\+js in IPv6-\/only mode. This means that you do not have to specify both {\ttfamily \+::ffff\+:a00\+:1} and {\ttfamily 10.\+0.\+0.\+1}.

As a convenience, this module also takes certain pre-\/defined names in addition to IP addresses, which expand into IP addresses\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \textcolor{stringliteral}{'loopback'})}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ ['loopback',\ 'fc00:ac:1ab5:fff::1/64'])}

\end{DoxyCode}



\begin{DoxyItemize}
\item {\ttfamily loopback}\+: IPv4 and IPv6 loopback addresses (like {\ttfamily \+::1} and {\ttfamily 127.\+0.\+0.\+1}).
\item {\ttfamily linklocal}\+: IPv4 and IPv6 link-\/local addresses (like {\ttfamily fe80\+:\+:1\+:1\+:1\+:1} and {\ttfamily 169.\+254.\+0.\+1}).
\item {\ttfamily uniquelocal}\+: IPv4 private addresses and IPv6 unique-\/local addresses (like {\ttfamily fc00\+:ac\+:1ab5\+:fff\+:\+:1} and {\ttfamily 192.\+168.\+0.\+1}).
\end{DoxyItemize}

When {\ttfamily trust} is specified as a function, it will be called for each address to determine if it is a trusted address. The function is given two arguments\+: {\ttfamily addr} and {\ttfamily i}, where {\ttfamily addr} is a string of the address to check and {\ttfamily i} is a number that represents the distance from the socket address.\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1622}{}\doxysubsection{\texorpdfstring{proxyaddr.\+all(req, \mbox{[}trust\mbox{]})}{proxyaddr.\+all(req, \mbox{[}trust\mbox{]})}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1622}
Return all the addresses of the request, optionally stopping at the first untrusted. This array is ordered from closest to furthest (i.\+e. {\ttfamily arr\mbox{[}0\mbox{]} === req.\+connection.\+remote\+Address}).


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}.all(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}})}

\end{DoxyCode}


The optional {\ttfamily trust} argument takes the same arguments as {\ttfamily trust} does in {\ttfamily \doxylink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr(req, trust)}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}.all(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ \textcolor{stringliteral}{'loopback'})}

\end{DoxyCode}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1623}{}\doxysubsection{\texorpdfstring{proxyaddr.\+compile(val)}{proxyaddr.\+compile(val)}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1623}
Compiles argument {\ttfamily val} into a {\ttfamily trust} function. This function takes the same arguments as {\ttfamily trust} does in {\ttfamily \doxylink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr(req, trust)}} and returns a function suitable for {\ttfamily \doxylink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr(req, trust)}}.


\begin{DoxyCode}{0}
\DoxyCodeLine{var\ trust\ =\ \mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}.compile(\textcolor{stringliteral}{'loopback'})}
\DoxyCodeLine{var\ addr\ =\ \mbox{\hyperlink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr}}(\mbox{\hyperlink{express_8js_a42c43c76081a7df8ae2954f16ee9338b}{req}},\ trust)}

\end{DoxyCode}


This function is meant to be optimized for use against every request. It is recommend to compile a trust function up-\/front for the trusted configuration and pass that to {\ttfamily \doxylink{request_8js_adccce5d9fde7ce401d03984f2d2a4715}{proxyaddr(req, trust)}} for each request.\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1624}{}\doxysection{\texorpdfstring{Testing}{Testing}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1624}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ test}

\end{DoxyCode}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1625}{}\doxysection{\texorpdfstring{Benchmarks}{Benchmarks}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1625}

\begin{DoxyCode}{0}
\DoxyCodeLine{\$\ npm\ run-\/script\ bench}

\end{DoxyCode}
\hypertarget{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1626}{}\doxysection{\texorpdfstring{License}{License}}\label{md_node__modules_2proxy-addr_2_r_e_a_d_m_e_autotoc_md1626}
\mbox{[}MIT\mbox{]}(LICENSE) 